# –î–µ–ø–ª–æ–π Telegram-–±–æ—Ç–∞ –¥–ª—è –∑–∞—è–≤–æ–∫

–ë–æ—Ç `AIDeliveryLeads_bot` —Å–æ–±–∏—Ä–∞–µ—Ç –∑–∞—è–≤–∫–∏ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥ (wizard) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç, —á—Ç–æ –∏ —Ñ–æ—Ä–º—ã —Å–∞–π—Ç–∞.

---

## 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------------|----------|-------------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –æ—Ç @BotFather | –î–∞ |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ –¥–ª—è –∑–∞—è–≤–æ–∫ (–≥—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª) | –î–∞ |
| `BOT_WEBHOOK_URL` | URL –¥–ª—è webhook (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ webhook-–¥–µ–ø–ª–æ–µ) | –ù–µ—Ç |

–¢–æ–∫–µ–Ω –∏ Chat ID ‚Äî —Ç–µ –∂–µ, —á—Ç–æ –∏ –¥–ª—è —Å–∞–π—Ç–∞. –°–º. [telegram-setup.md](./telegram-setup.md).

---

## 2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ .env –µ—Å—Ç—å TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID
npm run bot:dev   # dev —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
# –∏–ª–∏
npm run bot:start # prod
```

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ **long polling** ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram –∏ –æ–∂–∏–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

---

## 3. –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–ø–ª–æ—è

### –í–∞—Ä–∏–∞–Ω—Ç A: Long polling (Render, Railway, VPS)

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- Render (Background Worker)
- Railway
- –õ—é–±–æ–π VPS / –æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

**–®–∞–≥–∏:**
1. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `npm run bot:start`.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ Render/Railway –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`.
3. –î–µ–ø–ª–æ–π ‚Äî –±–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Telegram –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

**Railway:**
- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å ‚Üí Deploy from GitHub.
- Root directory: –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ).
- Start command: `npm run bot:start`.
- –î–æ–±–∞–≤—å—Ç–µ env vars.

**Render:**
- New ‚Üí Background Worker.
- Build: `npm install`.
- Start: `npm run bot:start`.

---

### –í–∞—Ä–∏–∞–Ω—Ç B: Webhook (Vercel, serverless)

Webhook –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è Vercel –∏–ª–∏ –¥—Ä—É–≥–∏—Ö serverless-–ø–ª–∞—Ç—Ñ–æ—Ä–º. –¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS-URL.

1. –°–æ–∑–¥–∞–π—Ç–µ API route (–Ω–∞–ø—Ä–∏–º–µ—Ä, `app/api/telegram-webhook/route.ts`), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST –æ—Ç Telegram.
2. –í BotFather –∏–ª–∏ —á–µ—Ä–µ–∑ `setWebhook` —É–∫–∞–∂–∏—Ç–µ URL: `https://your-domain.com/api/telegram-webhook`.
3. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `BOT_WEBHOOK_URL` ‚Äî –ø–æ–ª–Ω—ã–π URL webhook‚Äô–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤ –∫–æ–¥–µ).

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** Vercel serverless –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç execution time (10‚Äì60 —Å–µ–∫). –î–ª—è –±–æ—Ç–∞ —Å wizard –ª—É—á—à–µ long polling –Ω–∞ Render/Railway.

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
bot/
  index.ts          # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, /start
  flows/
    leadWizard.ts   # wizard: –∏–º—è ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí —É—Å–ª—É–≥–∞ ‚Üí —Å—Ä–æ–∫–∏ ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  lib/
    stateStore.ts   # in-memory —Å–æ—Å—Ç–æ—è–Ω–∏–µ (TTL 30 –º–∏–Ω)
    telegram.ts     # –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –≤ —á–∞—Ç
    antispam.ts     # rate limit, —Ñ–ª—É–¥-–∑–∞—â–∏—Ç–∞
```

---

## 5. –§–ª–æ—É –±–æ—Ç–∞

1. `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ ¬´–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É¬ª (—Å—Å—ã–ª–∫–∞ `?start=lead`).
2. `/lead` –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ `?start=lead` ‚Äî –∑–∞–ø—É—Å–∫ wizard:
   - –ò–º—è (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å).
   - –ö–æ–Ω—Ç–∞–∫—Ç: @username / —Ç–µ–ª–µ—Ñ–æ–Ω / email.
   - –£—Å–ª—É–≥–∞: –ë–æ—Ç, –°–∞–π—Ç, n8n, MiniApp, –ù–µ —É–≤–µ—Ä–µ–Ω.
   - –°—Ä–æ–∫–∏: 48‚Äì72—á, 3‚Äì5 –¥–Ω., 5‚Äì7 –¥–Ω., 7‚Äì10 –¥–Ω., –ù–µ —Å—Ä–æ—á–Ω–æ.
   - –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏.
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª –∏–ª–∏ ¬´–ò–∑–º–µ–Ω–∏—Ç—å¬ª.
3. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç, —á—Ç–æ –∏ —Å —Å–∞–π—Ç–∞, —Å —Ç–µ–≥–æ–º ¬´üü£ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Äî Telegram¬ª.

---

## 6. –ê–Ω—Ç–∏—Å–ø–∞–º

- **Rate limit:** –Ω–µ –±–æ–ª–µ–µ 3 –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ 30 –º–∏–Ω—É—Ç.
- **–§–ª—É–¥:** –µ—Å–ª–∏ –±–æ–ª—å—à–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥ –±–µ–∑ —à–∞–≥–∞ —Ñ–æ—Ä–º—ã ‚Äî –º—è–≥–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ.
- **–¢–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏:** 30 –º–∏–Ω—É—Ç –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Üí —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

## 7. –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start` –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ https://t.me/AIDeliveryLeads_bot?start=lead.
2. –ü—Ä–æ–π–¥–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–æ –∫–æ–Ω—Ü–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É.
3. –í —á–∞—Ç–µ –∑–∞—è–≤–æ–∫ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º ¬´üü£ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Äî Telegram¬ª.

–°–∞–π—Ç –∏ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é —Å—Ö–µ–º—É (`lib/lead/schema.ts`) –∏ –æ–±—â–∏–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ.
