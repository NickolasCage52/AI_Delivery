# Настройка Telegram-бота для заявок

Все формы сайта AI Delivery отправляют заявки в Telegram-чат через Bot API. Токен и Chat ID задаются в переменных окружения.

---

## 1. Создание бота

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram.
2. Отправьте `/newbot`.
3. Укажите имя и username бота.
4. Скопируйте **токен** вида `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`.

---

## 2. Получение Chat ID

### Вариант A: Личный чат

1. Напишите боту любое сообщение.
2. Откройте в браузере:
   ```
   https://api.telegram.org/bot<TOKEN>/getUpdates
   ```
3. В ответе найдите `"chat":{"id":123456789}` — это ваш Chat ID.

### Вариант B: Группа или канал

1. Создайте группу или используйте существующую.
2. Добавьте бота в группу (через меню → «Добавить участников»).
3. **Для группы**: сделайте бота администратором или как минимум дайте право писать сообщения.
4. Отправьте в группу любое сообщение (например `@`).
5. Вызовите `getUpdates`:
   ```
   https://api.telegram.org/bot<TOKEN>/getUpdates
   ```
6. Найдите `"chat":{"id":-1001234567890}` — у групп ID отрицательный.

### Вариант C: Канал

1. Создайте канал.
2. Добавьте бота как администратора с правом «Публиковать сообщения».
3. Перешлите сообщение из канала боту или опубликуйте пост.
4. В `getUpdates` найдите `"chat":{"id":-100xxxxxxxxxx}`.

---

## 3. Настройка переменных окружения

Добавьте в `.env.local`:

```env
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=-1001234567890
```

- `TELEGRAM_BOT_TOKEN` — токен от BotFather.
- `TELEGRAM_CHAT_ID` — ID чата (число, для групп — отрицательное).

---

## 4. Проверка отправки

1. Запустите проект: `npm run dev`.
2. Откройте форму: главная `/`, демо `/demo` или контакты `/contact`.
3. Заполните и отправьте форму.
4. В указанном чате должно появиться сообщение с карточкой заявки.

Формат сообщения:
- Заголовок: «Новая заявка — AI Delivery».
- Контакты: имя, контакт.
- Что нужно: тип/запрос, описание, сроки.
- Источник: страница, UTM (если есть).
- Время отправки.

---

## 5. Типичные проблемы

| Проблема | Решение |
|----------|---------|
| «Chat not found» | Бот не добавлен в группу/канал или ID указан неверно. |
| «Forbidden: bot can't initiate conversation» | В личный чат нужно первым написать боту. |
| «Forbidden: have no rights» | В группе/канале боту нужны права на отправку сообщений. |
| Сообщения не приходят | Проверьте `TELEGRAM_BOT_TOKEN` и `TELEGRAM_CHAT_ID` в `.env.local`. |

---

## 6. Безопасность

- Не публикуйте токен в репозитории. Добавьте `.env` и `.env.local` в `.gitignore`.
- Токен хранится только на сервере (`process.env`), клиент его не видит.
- API route использует rate limit (5 запросов / 10 минут на IP) и honeypot для защиты от спама.
